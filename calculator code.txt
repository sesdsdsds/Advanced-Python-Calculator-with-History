import os
import sys

# Calculation history file path
HISTORY_FILE = "calc_history.txt"

def save_to_file(result):
    """Save calculation result to a file."""
    try:
        with open(HISTORY_FILE, "a") as f:
            f.write(f"{result}\n")
        print(f"Result saved to {HISTORY_FILE}")
    except Exception as e:
        print(f"Error saving result: {e}")

def load_history():
    """Load calculation history from file."""
    if os.path.exists(HISTORY_FILE):
        with open(HISTORY_FILE, "r") as f:
            print("\nCalculation History:")
            print(f.read())
    else:
        print("No history found.")

def clear_history():
    """Clear calculation history."""
    try:
        open(HISTORY_FILE, "w").close()
        print("History cleared.")
    except Exception as e:
        print(f"Error clearing history: {e}")

def add(x, y):
    return x + y

def subtract(x, y):
    return x - y

def multiply(x, y):
    return x * y

def divide(x, y):
    if y != 0:
        return x / y
    else:
        return "Error: Division by zero"

def get_number(prompt):
    """Get a number from user input with error handling."""
    while True:
        try:
            return float(input(prompt))
        except ValueError:
            print("Invalid input. Please enter a number.")

def main():
    print("Calculator App")
    print("Type 'history' to view history, 'clear' to clear history, or 'exit' to quit.")
    
    while True:
        print("\nSelect operation:")
        print("1. Add")
        print("2. Subtract")
        print("3. Multiply")
        print("4. Divide")
        
        choice = input("Enter choice (1/2/3/4) or 'exit'/'history'/'clear': ").strip().lower()
        
        if choice == 'exit':
            print("Exiting...")
            break
        elif choice == 'history':
            load_history()
            continue
        elif choice == 'clear':
            clear_history()
            continue
        
        if choice in ['1', '2', '3', '4']:
            num1 = get_number("Enter first number: ")
            num2 = get_number("Enter second number: ")
            
            if choice == '1':
                result = f"{num1} + {num2} = {add(num1, num2)}"
            elif choice == '2':
                result = f"{num1} - {num2} = {subtract(num1, num2)}"
            elif choice == '3':
                result = f"{num1} * {num2} = {multiply(num1, num2)}"
            elif choice == '4':
                result = f"{num1} / {num2} = {divide(num1, num2)}"
            
            print(result)
            save_to_file(result)
        else:
            print("Invalid input. Please try again.")

if __name__ == "__main__":
    main()